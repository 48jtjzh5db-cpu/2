<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>é„­å®‰ç´˜çš„è‹±é›„æˆé•·éŒ„</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@900&display=swap" rel="stylesheet">
    
    <script>
        // ==========================================
        // ğŸ”§ å‹‡è€…å€‹äººè¨­å®š
        // ==========================================
        const MY_CONFIG = {
            heroName: "é„­å®‰ç´˜",
            avatarFile: "photo.jpg",  // è«‹ç¢ºä¿ç…§ç‰‡èˆ‡æ­¤æª”æ¡ˆæ”¾åœ¨åŒå€‹è³‡æ–™å¤¾
            subjects: [
                { id: 'chi',  name: 'åœ‹èª', task: 'å¯«ä½œæ¥­ / é–±è®€', icon: 'ğŸ“–' },
                { id: 'math', name: 'æ•¸å­¸', task: 'æ•¸å­¸ç·´ç¿’ / å¯«ä½œæ¥­', icon: 'ğŸ§ ' },
                { id: 'eng',  name: 'è‹±æ–‡', task: 'èƒŒå–®å­— / é–±è®€', icon: 'ğŸ—£ï¸' },
                { id: 'ball', name: 'é‹å‹•', task: 'è¶³çƒç·´ç¿’ / ä¸Šèª²', icon: 'âš½' },
                { id: 'life', name: 'ç”Ÿæ´»', task: 'æ•´ç†æ›¸åŒ… / å®¶äº‹', icon: 'ğŸ§¹' }
            ],
            // å¯¶ç‰©æ¸…å–®
            treasures: [
                { name: 'é«”åŠ›è—¥æ°´', icon: 'ğŸ§ª', desc: 'æ› 15 åˆ†é˜é›»è¦–æ™‚é–“' },
                { name: 'å‚³é€å·è»¸', icon: 'ğŸ“œ', desc: 'å…åšå®¶äº‹ä¸€æ¬¡' },
                { name: 'ç¥ç§˜æœå¯¦', icon: 'ğŸ', desc: 'æ›ä¸€å€‹å°é›¶é£Ÿ' },
                { name: 'é»ƒé‡‘çç‰Œ', icon: 'ğŸ¥‡', desc: 'ç²å¾—ä¸€å€‹å¯¦é«”å°çå‹µ' }
            ]
        };
    </script>

    <style>
        body {
            font-family: 'Noto Serif TC', serif; background-color: #dcd6c5;
            background-image: url('data:image/svg+xml,%3Csvg width="100" height="100" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg"%3E%3Cfilter id="n"%3E%3CfeTurbulence type="fractalNoise" baseFrequency="0.8"/%3E%3C/filter%3E%3Crect width="100%25" height="100%25" filter="url(%23n)" opacity="0.05"/%3E%3C/svg%3E');
            margin: 0; padding: 10px; color: #2c241b;
        }
        .container {
            max-width: 650px; margin: 0 auto; border: 4px double #4a3b2a; padding: 15px;
            background: rgba(245, 241, 232, 0.95); box-shadow: 0 10px 30px rgba(0,0,0,0.3); position: relative;
            border-radius: 10px;
        }
        h1 { text-align: center; border-bottom: 2px solid #8b0000; padding-bottom: 5px; margin: 10px 0; font-size: 1.8rem; }
        .header { display: flex; align-items: center; justify-content: center; gap: 15px; margin-bottom: 10px; }
        .avatar {
            width: 80px; height: 80px; border: 3px solid #8b0000; border-radius: 50%;
            background: #333 no-repeat center/cover; display: flex; align-items: center; justify-content: center; color: white;
        }
        .chart-box { height: 250px; width: 100%; margin: 10px 0; }
        
        /* ä»»å‹™åˆ—è¡¨ */
        .stat-item {
            background: rgba(255,255,255,0.7); border: 1px solid #c0b090;
            padding: 12px; border-radius: 12px; margin-bottom: 8px;
            display: flex; align-items: center; justify-content: space-between;
        }
        .bar-bg { width: 100px; height: 12px; background: #ddd; border-radius: 6px; overflow: hidden; border: 1px solid #aaa; }
        .bar-fill { height: 100%; background: linear-gradient(90deg, #d35400, #e67e22); width: 0%; transition: 0.4s; }
        
        /* å„²ç‰©ç®± */
        .inventory-title { border-top: 2px solid #8b0000; margin-top: 20px; padding-top: 10px; font-weight: 900; }
        .inventory-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-top: 10px; }
        .inv-slot { 
            aspect-ratio: 1; background: #eee; border: 1px dashed #999; border-radius: 8px;
            display: flex; align-items: center; justify-content: center; font-size: 1.5rem; cursor: pointer;
        }
        .inv-slot.has-item { background: #fff; border: 2px solid #8b0000; box-shadow: 2px 2px 5px rgba(0,0,0,0.1); }

        button { 
            background: #4a3b2a; color: #f5f1e8; border: none; padding: 10px 15px; 
            border-radius: 8px; cursor: pointer; box-shadow: 2px 2px 0 #000; font-family: inherit; font-weight: bold;
        }
        button:active { transform: translate(1px, 1px); box-shadow: none; }
    </style>
</head>
<body>

<div class="container">
    <h1 id="title-name">è‹±é›„æˆé•·ç´€éŒ„</h1>

    <div class="header">
        <div id="hero-img" class="avatar">?</div>
        <div style="text-align:left">
            <div id="display-name" style="font-size:1.4rem; font-weight:900;">è¼‰å…¥ä¸­...</div>
            <div style="font-size:0.9rem; color:#8b0000;">ç­‰ç´šï¼šLv.<span id="total-lv">0</span> | èƒ½åŠ›ç¸½å’Œï¼š<span id="total-val">0</span></div>
        </div>
    </div>

    <div class="chart-box"><canvas id="radar"></canvas></div>

    <div id="list"></div>

    <div class="inventory-title">ğŸ’ å‹‡è€…å„²ç‰©ç®± (é»æ“Šä½¿ç”¨)</div>
    <div class="inventory-grid" id="inventory"></div>

    <div style="text-align:center; margin-top:30px; color:#aaa; font-size:0.7rem; cursor:pointer;" onclick="if(confirm('ç¢ºå®šé‡ç½®ï¼Ÿ')){localStorage.clear();location.reload();}">é‡ç½®æ•¸æ“š</div>
</div>

<script>
    // åˆå§‹åŒ–è¨­å®š
    document.getElementById('display-name').innerText = MY_CONFIG.heroName;
    const imgDiv = document.getElementById('hero-img');
    if(MY_CONFIG.avatarFile) {
        imgDiv.style.backgroundImage = `url('${MY_CONFIG.avatarFile}')`;
        imgDiv.innerText = '';
    } else {
        imgDiv.innerText = MY_CONFIG.heroName[0];
    }

    // è®€å–é€²åº¦
    let data = JSON.parse(localStorage.getItem('hero_save_final')) || {
        stats: {},
        inventory: []
    };
    
    // åˆå§‹åŒ–ç§‘ç›®æ•¸å€¼
    MY_CONFIG.subjects.forEach(s => {
        if(!data.stats[s.id]) data.stats[s.id] = { val: 10, exp: 0 }; 
    });

    // åˆå§‹åŒ–é›·é”åœ–
    const ctx = document.getElementById('radar').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: MY_CONFIG.subjects.map(s => s.name),
            datasets: [{
                data: MY_CONFIG.subjects.map(s => data.stats[s.id].val),
                backgroundColor: 'rgba(139, 0, 0, 0.2)', borderColor: '#8b0000', borderWidth: 2, pointRadius: 4
            }]
        },
        options: {
            scales: { r: { suggestedMin: 0, suggestedMax: 50, ticks: { display: false }, pointLabels: { font: { size: 14, weight: 'bold' } } } },
            plugins: { legend: { display: false } }
        }
    });

    // æ¸²æŸ“å‡½æ•¸
    function render() {
        const list = document.getElementById('list');
        list.innerHTML = '';
        let totalVal = 0;
        
        MY_CONFIG.subjects.forEach((s, idx) => {
            let sData = data.stats[s.id];
            totalVal += sData.val;
            list.innerHTML += `
                <div class="stat-item">
                    <div style="width:40%"><b>${s.icon} ${s.name}</b><br><small style="color:#666; font-size:0.7rem;">${s.task}</small></div>
                    <div style="font-size:1.4rem; color:#8b0000; font-weight:bold; width:15%">${sData.val}</div>
                    <div style="text-align:right; width:45%">
                        <div class="bar-bg"><div class="bar-fill" style="width:${sData.exp}%"></div></div>
                        <button onclick="addExp('${s.id}', ${idx})">å®Œæˆä»»å‹™</button>
                    </div>
                </div>
            `;
        });

        // æ›´æ–°ç¸½ç­‰ç´š (èƒ½åŠ›æ¯å‡ 5 é» = 1 ç´š)
        document.getElementById('total-val').innerText = totalVal;
        document.getElementById('total-lv').innerText = Math.floor(totalVal / 5);

        // æ›´æ–°å„²ç‰©ç®±
        const invGrid = document.getElementById('inventory');
        invGrid.innerHTML = '';
        for(let i=0; i<8; i++) {
            const item = data.inventory[i];
            const slot = document.createElement('div');
            slot.className = 'inv-slot' + (item ? ' has-item' : '');
            slot.innerHTML = item ? item.icon : '';
            if(item) slot.onclick = () => useItem(i);
            invGrid.appendChild(slot);
        }

        localStorage.setItem('hero_save_final', JSON.stringify(data));
    }

    // å¢åŠ ç¶“é©—å€¼é‚è¼¯
    function addExp(id, idx) {
        // æ–°æ‰‹è£œè²¼ï¼šèƒ½åŠ›å€¼ä½æ–¼ 20 æ™‚å‡ç´šè¼ƒå¿«
        let currentVal = data.stats[id].val;
        let gain = (currentVal < 20) ? 34 : 20; // å‰æœŸé»3ä¸‹å‡ç´šï¼Œå¾ŒæœŸé»5ä¸‹
        
        data.stats[id].exp += gain;

        if(data.stats[id].exp >= 100) {
            data.stats[id].exp = 0;
            data.stats[id].val++;
            
            // å‡ç´šå‹•ç•«
            confetti({ particleCount: 150, spread: 70, origin: { y: 0.6 } });
            
            // éš¨æ©Ÿç²å¾—å¯¶ç‰© (25% æ©Ÿç‡)
            if(Math.random() < 0.25 && data.inventory.length < 8) {
                const prize = MY_CONFIG.treasures[Math.floor(Math.random() * MY_CONFIG.treasures.length)];
                data.inventory.push(prize);
                setTimeout(() => alert(`ğŸ‰ æ­å–œï¼ç²å¾—å¯¶ç‰©ï¼š${prize.name}ï¼`), 500);
            }

            chart.data.datasets[0].data[idx] = data.stats[id].val;
            chart.update();
        }
        render();
    }

    function useItem(index) {
        const item = data.inventory[index];
        if(confirm(`ä½¿ç”¨ã€${item.name}ã€‘ï¼Ÿ\næ•ˆæœï¼š${item.desc}`)) {
            data.inventory.splice(index, 1);
            render();
        }
    }

    render();
</script>
</body>
</html>
