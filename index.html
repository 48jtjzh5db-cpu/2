<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å®‰ç´˜çš„è‹±é›„å‚³èªª</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.5.1/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@900&display=swap" rel="stylesheet">
    
    <style>
        :root { --main-red: #8b0000; --paper: #f5f1e8; --dark: #4a3b2a; }
        body { font-family: 'Noto Serif TC', serif; background-color: #dcd6c5; margin: 0; padding: 0; color: #2c241b; overflow-x: hidden; }
        
        /* å°è¦½åˆ— */
        .nav-bar { position: fixed; bottom: 0; width: 100%; background: var(--dark); display: flex; justify-content: space-around; padding: 10px 0; z-index: 100; box-shadow: 0 -2px 10px rgba(0,0,0,0.3); }
        .nav-item { color: #aaa; text-decoration: none; font-size: 0.8rem; text-align: center; cursor: pointer; }
        .nav-item.active { color: #fff; }
        .nav-item div { font-size: 1.5rem; }

        /* é é¢å®¹å™¨ */
        .page { display: none; padding: 20px 15px 80px 15px; max-width: 650px; margin: 0 auto; animation: fadeIn 0.3s ease; }
        .page.active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* å¡ç‰‡èˆ‡æ¨£å¼ */
        .container { border: 4px double var(--main-red); padding: 15px; background: rgba(245, 241, 232, 0.95); box-shadow: 0 5px 15px rgba(0,0,0,0.2); border-radius: 10px; margin-bottom: 20px; }
        h1 { text-align: center; border-bottom: 2px solid var(--main-red); margin: 0 0 15px 0; font-size: 1.5rem; }
        
        /* ä»»å‹™æ¸…å–®æ¨£å¼ */
        .daily-item { display: flex; align-items: center; background: white; padding: 15px; border-radius: 12px; margin-bottom: 10px; border: 1px solid #c0b090; }
        .daily-item.done { opacity: 0.6; background: #e8e8e8; text-decoration: line-through; }
        .check-btn { width: 30px; height: 30px; border: 2px solid var(--main-red); border-radius: 50%; margin-right: 15px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-weight: bold; }
        
        /* æ­·å²ç´€éŒ„æ¨£å¼ */
        .history-card { background: white; padding: 10px; border-radius: 8px; margin-bottom: 10px; font-size: 0.9rem; border-left: 5px solid var(--main-red); }
        .history-date { font-weight: bold; color: var(--main-red); margin-bottom: 5px; }

        /* åŸæœ‰å±¬æ€§æ¨£å¼ */
        .chart-box { height: 250px; width: 100%; margin: 10px 0; }
        .bar-bg { width: 80px; height: 10px; background: #ddd; border-radius: 5px; overflow: hidden; }
        .bar-fill { height: 100%; background: #d35400; width: 0%; transition: 0.3s; }
        button { background: var(--dark); color: white; border: none; padding: 8px 12px; border-radius: 5px; cursor: pointer; }
    </style>
</head>
<body>

<div class="nav-bar">
    <div class="nav-item active" onclick="showPage('status', this)"><div>ğŸ‘¤</div>è‹±é›„</div>
    <div class="nav-item" onclick="showPage('daily', this)"><div>ğŸ“œ</div>ä»»å‹™</div>
    <div class="nav-item" onclick="showPage('history', this)"><div>â³</div>è¶³è·¡</div>
</div>

<div id="status" class="page active">
    <div class="container">
        <h1>ğŸ›¡ï¸ è‹±é›„æˆé•·ç´€éŒ„</h1>
        <div style="text-align: center; margin-bottom: 15px;">
            <div style="font-size: 1.4rem; font-weight: 900;">é„­å®‰ç´˜</div>
            <div style="color: var(--main-red);">ç­‰ç´š Lv.<span id="total-lv">1</span></div>
        </div>
        <div class="chart-box"><canvas id="radar"></canvas></div>
        <div id="attr-list"></div>
    </div>
</div>

<div id="daily" class="page">
    <div class="container">
        <h1>ğŸ“œ æ¯æ—¥æŒ‘æˆ°</h1>
        <p style="text-align: center; font-size: 0.8rem; color: #666;">é”æˆä»»å‹™å¯ç²å¾—å±¬æ€§ç¶“é©—èˆ‡éš¨æ©Ÿå¯¶ç‰©</p>
        <div id="daily-list"></div>
    </div>
</div>

<div id="history" class="page">
    <div class="container">
        <h1>â³ å†’éšªè¶³è·¡</h1>
        <div id="history-list"></div>
    </div>
</div>

<script>
    // 1. è¨­å®šèˆ‡åˆå§‹åŒ–
    const CONFIG = {
        subjects: [
            { id: 'chi', name: 'åœ‹èª', icon: 'ğŸ“–', target: 'åœ‹èªä½œæ¥­' },
            { id: 'math', name: 'æ•¸å­¸', icon: 'ğŸ§ ', target: 'æ•¸å­¸ç·´ç¿’' },
            { id: 'eng', name: 'è‹±æ–‡', icon: 'ğŸ—£ï¸', target: 'è‹±æ–‡é–±è®€' },
            { id: 'ball', name: 'é‹å‹•', icon: 'âš½', target: 'è¶³çƒè¨“ç·´' },
            { id: 'life', name: 'ç”Ÿæ´»', icon: 'ğŸ§¹', target: 'æ•´ç†å®¶äº‹' }
        ]
    };

    let data = JSON.parse(localStorage.getItem('hero_v3')) || {
        stats: { chi:30, math:30, eng:30, ball:30, life:30 },
        exps: { chi:0, math:0, eng:0, ball:0, life:0 },
        dailyDone: {}, // ç´€éŒ„æ ¼å¼ { "2025-12-31": ["chi", "math"] }
        history: [] // ç´€éŒ„æ ¼å¼ { date: "...", text: "..." }
    };

    // 2. åˆ‡æ›é é¢é‚è¼¯
    function showPage(pageId, el) {
        document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
        document.getElementById(pageId).classList.add('active');
        el.classList.add('active');
        if(pageId === 'history') renderHistory();
    }

    // 3. æ ¸å¿ƒé›·é”åœ–
    const ctx = document.getElementById('radar').getContext('2d');
    const chart = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: CONFIG.subjects.map(s => s.name),
            datasets: [{
                data: CONFIG.subjects.map(s => data.stats[s.id]),
                backgroundColor: 'rgba(139, 0, 0, 0.2)', borderColor: '#8b0000', borderWidth: 2
            }]
        },
        options: { scales: { r: { suggestedMin: 0, suggestedMax: 100, ticks: { display: false } } }, plugins: { legend: { display: false } } }
    });

    // 4. æ¸²æŸ“é‚è¼¯
    function renderStatus() {
        const list = document.getElementById('attr-list');
        list.innerHTML = '';
        let total = 0;
        CONFIG.subjects.forEach((s, idx) => {
            total += data.stats[s.id];
            list.innerHTML += `
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:10px; background:white; padding:10px; border-radius:8px;">
                    <b>${s.icon} ${s.name}</b>
                    <span style="font-weight:bold; color:var(--main-red)">${data.stats[s.id]}</span>
                    <div class="bar-bg"><div class="bar-fill" style="width:${data.exps[s.id]}%"></div></div>
                </div>
            `;
        });
        document.getElementById('total-lv').innerText = Math.floor(total / 5);
        chart.data.datasets[0].data = CONFIG.subjects.map(s => data.stats[s.id]);
        chart.update();
    }

    function renderDaily() {
        const today = new Date().toLocaleDateString();
        const doneList = data.dailyDone[today] || [];
        const list = document.getElementById('daily-list');
        list.innerHTML = '';

        CONFIG.subjects.forEach(s => {
            const isDone = doneList.includes(s.id);
            list.innerHTML += `
                <div class="daily-item ${isDone ? 'done' : ''}">
                    <div class="check-btn" onclick="completeTask('${s.id}')">${isDone ? 'âœ“' : ''}</div>
                    <div><b>å®Œæˆä»Šæ—¥${s.target}</b></div>
                </div>
            `;
        });
    }

    function renderHistory() {
        const list = document.getElementById('history-list');
        list.innerHTML = data.history.length ? '' : '<p style="text-align:center">å°šç„¡å†’éšªç´€éŒ„</p>';
        data.history.slice(-20).reverse().forEach(h => {
            list.innerHTML += `
                <div class="history-card">
                    <div class="history-date">${h.date}</div>
                    <div>${h.text}</div>
                </div>
            `;
        });
    }

    // 5. ä»»å‹™åŸ·è¡Œé‚è¼¯
    function completeTask(id) {
        const today = new Date().toLocaleDateString();
        if(!data.dailyDone[today]) data.dailyDone[today] = [];
        if(data.dailyDone[today].includes(id)) return;

        data.dailyDone[today].push(id);
        
        // å¢åŠ ç¶“é©— (å°äºŒç¨‹åº¦ï¼Œé»3ä¸‹å‡ç´š)
        data.exps[id] += 34;
        let logText = `å®Œæˆäº† ${CONFIG.subjects.find(s=>s.id===id).name} ä»»å‹™ï¼Œç²å¾—ç¶“é©—ï¼`;

        if(data.exps[id] >= 100) {
            data.exps[id] = 0;
            data.stats[id]++;
            logText += ` âœ¨èƒ½åŠ›çªç ´è‡³ ${data.stats[id]}ï¼`;
            confetti({ particleCount: 100, spread: 70, origin: { y: 0.6 } });
        }

        data.history.push({ date: new Date().toLocaleString(), text: logText });
        save();
        renderStatus();
        renderDaily();
    }

    function save() { localStorage.setItem('hero_v3', JSON.stringify(data)); }

    renderStatus();
    renderDaily();
</script>
</body>
</html>
